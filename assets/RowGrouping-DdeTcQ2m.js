import{DataGrid as e,RowSelectionContext as t,SELECT_COLUMN_KEY as n,SelectColumn as r,assertIsValidKeyGetter as i,clsx_default as a,defaultRenderRow as o,getCellClassname as s,getCellStyle as c,getLeftRightKey as l,getRowStyle as u,rowClassname as d,rowSelectedClassname as f,useDefaultRenderers as p,useLatestFunc as m,useRovingTabIndex as h}from"./DataGrid-DeyN1_mD.js";import{__toESM as g,f as _,require_jsx_runtime as v,require_react as y,useDirection as b}from"./index-BpoX4Tte.js";var x=g(v());const S=`g1s9ylgp`,C=`rdg-group-cell-content ${S}`,w=`cz54e4y`,T=`rdg-caret ${w}`;function E(e){return(0,x.jsx)(D,{...e})}function D({groupKey:e,isExpanded:t,tabIndex:n,toggleGroup:r}){function i({key:e}){e===`Enter`&&r()}let a=t?`M1 1 L 7 7 L 13 1`:`M1 7 L 7 1 L 13 7`;return(0,x.jsxs)(`span`,{className:C,tabIndex:n,onKeyDown:i,children:[e,(0,x.jsx)(`svg`,{viewBox:`0 0 14 8`,width:`14`,height:`8`,className:T,"aria-hidden":!0,children:(0,x.jsx)(`path`,{d:a})})]})}var O=g(y());function k({id:e,groupKey:t,childRows:n,isExpanded:r,isCellSelected:i,column:a,row:o,groupColumnIndex:l,isGroupByColumn:u,toggleGroup:d}){let{tabIndex:f,childTabIndex:p,onFocus:m}=h(i);function g(){d(e)}let _=u&&l===a.idx;return(0,x.jsx)(`div`,{role:`gridcell`,"aria-colindex":a.idx+1,"aria-selected":i,tabIndex:f,className:s(a),style:{...c(a),cursor:_?`pointer`:`default`},onMouseDown:e=>{e.preventDefault()},onClick:_?g:void 0,onFocus:m,children:(!u||_)&&a.renderGroupCell?.({groupKey:t,childRows:n,column:a,row:o,isExpanded:r,tabIndex:p,toggleGroup:g})},a.key)}var A=(0,O.memo)(k);const j=`g1yxluv3`,M=`rdg-group-row ${j}`;function N({className:e,row:r,rowIdx:i,viewportColumns:o,selectedCellIdx:s,isRowSelected:c,selectCell:l,gridRowStart:p,groupBy:m,toggleGroup:h,isRowSelectionDisabled:g,..._}){let v=o[0].key===n?r.level+1:r.level;function y(){l({rowIdx:i,idx:-1},{shouldFocusCell:!0})}let b=(0,O.useMemo)(()=>({isRowSelectionDisabled:!1,isRowSelected:c}),[c]);return(0,x.jsx)(t,{value:b,children:(0,x.jsx)(`div`,{role:`row`,"aria-level":r.level+1,"aria-setsize":r.setSize,"aria-posinset":r.posInSet+1,"aria-expanded":r.isExpanded,className:a(d,M,`rdg-row-${i%2==0?`even`:`odd`}`,s===-1&&f,e),onMouseDown:y,style:u(p),..._,children:o.map(e=>(0,x.jsx)(A,{id:r.id,groupKey:r.groupKey,childRows:r.childRows,isExpanded:r.isExpanded,isCellSelected:s===e.idx,column:e,row:r,groupColumnIndex:v,toggleGroup:h,isGroupByColumn:m.includes(e.key)},e.key))})})}var P=(0,O.memo)(N);function F({columns:t,rows:r,rowHeight:a,rowKeyGetter:s,onCellKeyDown:c,onCellCopy:u,onCellPaste:d,onRowsChange:f,selectedRows:h,onSelectedRowsChange:g,renderers:_,groupBy:v,rowGrouper:y,expandedGroupIds:b,onExpandedGroupIdsChange:S,groupIdGetter:C,...w}){let T=p(),D=_?.renderRow??T?.renderRow??o,k=1+(w.topSummaryRows?.length??0),{leftKey:A,rightKey:j}=l(w.direction),M=m(Q),N=C??I,{columns:F,groupBy:R}=(0,O.useMemo)(()=>{let e=t.toSorted(({key:e},{key:t})=>e===n?-1:t===n?1:v.includes(e)?v.includes(t)?v.indexOf(e)-v.indexOf(t):-1:v.includes(t)?1:0),r=[];for(let[t,n]of e.entries())v.includes(n.key)&&(r.push(n.key),e[t]={...n,frozen:!0,renderCell:()=>null,renderGroupCell:n.renderGroupCell??E,editable:!1});return{columns:e,groupBy:r}},[t,v]),[z,B]=(0,O.useMemo)(()=>{if(R.length===0)return[void 0,r.length];let e=(t,[n,...r],i)=>{let a=0,o={};for(let[s,c]of Object.entries(y(t,n))){let[t,n]=r.length===0?[c,c.length]:e(c,r,i+a+1);o[s]={childRows:c,childGroups:t,startRowIndex:i+a},a+=n+1}return[o,a]};return e(r,R,0)},[R,y,r]),[V,H]=(0,O.useMemo)(()=>{let e=new Set;if(!z)return[r,i];let t=[],n=(r,i,a)=>{if(L(r)){t.push(...r);return}Object.keys(r).forEach((o,s,c)=>{let l=N(o,i),u=b.has(l),{childRows:d,childGroups:f,startRowIndex:p}=r[o],m={id:l,parentId:i,groupKey:o,isExpanded:u,childRows:d,level:a,posInSet:s,startRowIndex:p,setSize:c.length};t.push(m),e.add(m),u&&n(f,l,a+1)})};return n(z,void 0,0),[t,i];function i(t){return e.has(t)}},[b,z,r,N]),U=(0,O.useMemo)(()=>typeof a==`function`?e=>H(e)?a({type:`GROUP`,row:e}):a({type:`ROW`,row:e}):a,[H,a]),W=(0,O.useCallback)(e=>{let t=V.indexOf(e);for(let n=t-1;n>=0;n--){let t=V[n];if(H(t)&&(!H(e)||e.parentId===t.id))return[t,n]}},[H,V]),G=(0,O.useCallback)(e=>{if(H(e))return e.id;if(typeof s==`function`)return s(e);let t=W(e);if(t!==void 0){let{startRowIndex:n,childRows:r}=t[0],i=r.indexOf(e);return n+i+1}return V.indexOf(e)},[W,H,s,V]),K=(0,O.useMemo)(()=>{if(h==null)return null;i(s);let e=new Set(h);for(let t of V)if(H(t)){let n=t.childRows.every(e=>h.has(s(e)));n&&e.add(t.id)}return e},[H,s,h,V]);function q(e){if(!g)return;i(s);let t=new Set(h);for(let n of V){let r=G(n);if(K?.has(r)&&!e.has(r))if(H(n))for(let e of n.childRows)t.delete(s(e));else t.delete(r);else if(!K?.has(r)&&e.has(r))if(H(n))for(let e of n.childRows)t.add(s(e));else t.add(r)}g(t)}function J(e,t){if(c?.(e,t),t.isGridDefaultPrevented()||e.mode===`EDIT`)return;let{column:n,rowIdx:r,selectCell:i}=e,a=n?.idx??-1,o=V[r];if(H(o)&&(a===-1&&(t.key===A&&o.isExpanded||t.key===j&&!o.isExpanded)&&(t.preventDefault(),t.preventGridDefault(),Q(o.id)),a===-1&&t.key===A&&!o.isExpanded&&o.level!==0)){let e=W(o);e!==void 0&&(t.preventGridDefault(),i({idx:a,rowIdx:e[1]}))}}function Y({row:e,column:t},n){H(e)||u?.({row:e,column:t},n)}function X({row:e,column:t},n){return H(e)?e:d({row:e,column:t},n)}function Z(e,{indexes:t,column:n}){if(!f)return;let i=[...r],a=[];for(let n of t){let t=r.indexOf(V[n]);i[t]=e[n],a.push(t)}f(i,{indexes:a,column:n})}function Q(e){let t=new Set(b);t.has(e)?t.delete(e):t.add(e),S(t)}function $(e,{row:t,rowClass:n,onCellMouseDown:r,onCellClick:i,onCellDoubleClick:a,onCellContextMenu:o,onRowChange:s,lastFrozenColumnIndex:c,draggedOverCellIdx:l,selectedCellEditor:u,...d}){if(H(t)){let{startRowIndex:n}=t;return(0,x.jsx)(P,{...d,"aria-rowindex":k+n+1,row:t,groupBy:R,toggleGroup:M},e)}let f=d[`aria-rowindex`],p=W(t);if(p!==void 0){let{startRowIndex:e,childRows:n}=p[0],r=n.indexOf(t);f=e+k+r+2}return D(e,{...d,"aria-rowindex":f,row:t,rowClass:n,onCellMouseDown:r,onCellClick:i,onCellDoubleClick:a,onCellContextMenu:o,onRowChange:s,lastFrozenColumnIndex:c,draggedOverCellIdx:l,selectedCellEditor:u})}return(0,x.jsx)(e,{...w,role:`treegrid`,"aria-rowcount":B+1+(w.topSummaryRows?.length??0)+(w.bottomSummaryRows?.length??0),columns:F,rows:V,rowHeight:U,rowKeyGetter:G,onRowsChange:Z,selectedRows:K,onSelectedRowsChange:q,onCellKeyDown:J,onCellCopy:Y,onCellPaste:d?X:void 0,renderers:{..._,renderRow:$}})}function I(e,t){return t===void 0?e:`${t}__${e}`}function L(e){return Array.isArray(e)}const R=`g8apzrt`,z=`o12aimxb`,B=`Swimming.Gymnastics.Speed Skating.Cross Country Skiing.Short-Track Speed Skating.Diving.Cycling.Biathlon.Alpine Skiing.Ski Jumping.Nordic Combined.Athletics.Table Tennis.Tennis.Synchronized Swimming.Shooting.Rowing.Fencing.Equestrian.Canoeing.Bobsleigh.Badminton.Archery.Wrestling.Weightlifting.Waterpolo.Wrestling.Weightlifting`.split(`.`),V=[r,{key:`country`,name:`Country`},{key:`year`,name:`Year`},{key:`sport`,name:`Sport`},{key:`athlete`,name:`Athlete`},{key:`gold`,name:`Gold`,renderGroupCell({childRows:e}){return e.reduce((e,{gold:t})=>e+t,0)}},{key:`silver`,name:`Silver`,renderGroupCell({childRows:e}){return e.reduce((e,{silver:t})=>e+t,0)}},{key:`bronze`,name:`Bronze`,renderGroupCell({childRows:e}){return e.reduce((e,{silver:t})=>e+t,0)}},{key:`total`,name:`Total`,renderCell({row:e}){return e.gold+e.silver+e.bronze},renderGroupCell({childRows:e}){return e.reduce((e,t)=>e+t.gold+t.silver+t.bronze,0)}}];function H(e){return e.id}function U(){let e=[];for(let t=1;t<1e4;t++)e.push({id:t,year:2015+_.number.int(3),country:_.location.country(),sport:B[_.number.int(B.length-1)],athlete:_.person.fullName(),gold:_.number.int(5),silver:_.number.int(5),bronze:_.number.int(5)});return e.sort((e,t)=>t.country.localeCompare(e.country))}const W=[`country`,`year`,`sport`,`athlete`];function G(e,t){return Object.groupBy(e,e=>e[t])}const K=function(){let e=b(),[t]=(0,O.useState)(U),[n,r]=(0,O.useState)(()=>new Set),[i,a]=(0,O.useState)([W[0],W[1]]),[o,s]=(0,O.useState)(()=>new Set([`United States of America`,`United States of America__2015`]));function c(e,t){let n=i.indexOf(e);t?n===-1&&a(t=>[...t,e]):n!==-1&&a(e=>e.toSpliced(n,1)),s(new Set)}return(0,x.jsxs)(`div`,{className:R,children:[(0,x.jsx)(`b`,{children:`Group by columns:`}),(0,x.jsx)(`div`,{className:z,children:W.map(e=>(0,x.jsxs)(`label`,{children:[(0,x.jsx)(`input`,{type:`checkbox`,checked:i.includes(e),onChange:t=>c(e,t.target.checked)}),` `,e]},e))}),(0,x.jsx)(F,{"aria-label":`Row Grouping Example`,columns:V,rows:t,rowKeyGetter:H,selectedRows:n,onSelectedRowsChange:r,groupBy:i,rowGrouper:G,expandedGroupIds:o,onExpandedGroupIdsChange:s,defaultColumnOptions:{resizable:!0},direction:e})]})};export{K as component};
//# sourceMappingURL=RowGrouping-DdeTcQ2m.js.map