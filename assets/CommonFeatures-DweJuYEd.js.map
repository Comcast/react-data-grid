{"version":3,"file":"CommonFeatures-DweJuYEd.js","names":["useMemo","useRef","useState","createPortal","flushSync","faker","css","DataGrid","SelectCellFormatter","SelectColumn","textEditor","Column","DataGridHandle","SortColumn","textEditorClassname","Direction","exportToCsv","exportToPdf","useDirection","Route","toolbarClassname","dialogContainerClassname","dateFormatter","Intl","DateTimeFormat","navigator","language","currencyFormatter","NumberFormat","style","currency","SummaryRow","id","totalCount","yesCount","Row","title","client","area","country","contact","assignee","progress","startTimestamp","endTimestamp","budget","transaction","account","version","available","getColumns","countries","direction","key","name","frozen","resizable","renderSummaryCell","renderEditCell","row","width","draggable","p","e","onRowChange","target","value","map","renderCell","props","inlineSize","Math","round","onClose","event","valueAsNumber","document","body","editorOptions","displayCellContent","format","tabIndex","floor","rowKeyGetter","createRows","now","Date","rows","countrySet","Set","i","location","add","push","company","person","jobArea","internet","exampleEmail","fullName","random","finance","transactionType","iban","system","semver","sort","Collator","compare","Comparator","a","b","getComparator","sortColumn","localeCompare","Error","SplitComponent","CommonFeatures","setRows","sortColumns","setSortColumns","selectedRows","setSelectedRows","ReadonlySet","isExporting","setIsExporting","gridRef","columns","summaryRows","length","filter","r","sortedRows","toSorted","comparator","columnKey","compResult","handleExportToCsv","current","element","handleExportToPdf","sortable","component"],"sources":["../../website/routes/CommonFeatures.tsx?tsr-split=component"],"sourcesContent":["import { useMemo, useRef, useState } from 'react';\nimport { createPortal, flushSync } from 'react-dom';\nimport { faker } from '@faker-js/faker';\nimport { css } from '@linaria/core';\n\nimport {\n  DataGrid,\n  SelectCellFormatter,\n  SelectColumn,\n  textEditor,\n  type Column,\n  type DataGridHandle,\n  type SortColumn\n} from '../../src';\nimport { textEditorClassname } from '../../src/editors/textEditor';\nimport type { Direction } from '../../src/types';\nimport { exportToCsv, exportToPdf } from '../utils';\nimport { useDirection } from '../directionContext';\n\nexport const Route = createFileRoute({\n  component: CommonFeatures\n});\n\nconst toolbarClassname = css`\n  display: flex;\n  justify-content: flex-end;\n  gap: 8px;\n  margin-block-end: 8px;\n`;\n\nconst dialogContainerClassname = css`\n  position: absolute;\n  inset: 0;\n  display: flex;\n  place-items: center;\n  background: rgba(0, 0, 0, 0.1);\n\n  > dialog {\n    width: 300px;\n    > input {\n      width: 100%;\n    }\n\n    > menu {\n      text-align: end;\n    }\n  }\n`;\n\nconst dateFormatter = new Intl.DateTimeFormat(navigator.language);\nconst currencyFormatter = new Intl.NumberFormat(navigator.language, {\n  style: 'currency',\n  currency: 'eur'\n});\n\ninterface SummaryRow {\n  id: string;\n  totalCount: number;\n  yesCount: number;\n}\n\ninterface Row {\n  id: number;\n  title: string;\n  client: string;\n  area: string;\n  country: string;\n  contact: string;\n  assignee: string;\n  progress: number;\n  startTimestamp: number;\n  endTimestamp: number;\n  budget: number;\n  transaction: string;\n  account: string;\n  version: string;\n  available: boolean;\n}\n\nfunction getColumns(\n  countries: readonly string[],\n  direction: Direction\n): readonly Column<Row, SummaryRow>[] {\n  return [\n    SelectColumn,\n    {\n      key: 'id',\n      name: 'ID',\n      frozen: true,\n      resizable: false,\n      renderSummaryCell() {\n        return <strong>Total</strong>;\n      }\n    },\n    {\n      key: 'title',\n      name: 'Task',\n      frozen: true,\n      renderEditCell: textEditor,\n      renderSummaryCell({ row }) {\n        return `${row.totalCount} records`;\n      }\n    },\n    {\n      key: 'client',\n      name: 'Client',\n      width: 'max-content',\n      draggable: true,\n      renderEditCell: textEditor\n    },\n    {\n      key: 'area',\n      name: 'Area',\n      renderEditCell: textEditor\n    },\n    {\n      key: 'country',\n      name: 'Country',\n      renderEditCell: (p) => (\n        <select\n          autoFocus\n          className={textEditorClassname}\n          value={p.row.country}\n          onChange={(e) => p.onRowChange({ ...p.row, country: e.target.value }, true)}\n        >\n          {countries.map((country) => (\n            <option key={country}>{country}</option>\n          ))}\n        </select>\n      )\n    },\n    {\n      key: 'contact',\n      name: 'Contact',\n      renderEditCell: textEditor\n    },\n    {\n      key: 'assignee',\n      name: 'Assignee',\n      renderEditCell: textEditor\n    },\n    {\n      key: 'progress',\n      name: 'Completion',\n      renderCell(props) {\n        const value = props.row.progress;\n        return (\n          <>\n            <progress max={100} value={value} style={{ inlineSize: 50 }} /> {Math.round(value)}%\n          </>\n        );\n      },\n      renderEditCell({ row, onRowChange, onClose }) {\n        return createPortal(\n          <div\n            dir={direction}\n            className={dialogContainerClassname}\n            onKeyDown={(event) => {\n              if (event.key === 'Escape') {\n                onClose();\n              }\n            }}\n          >\n            <dialog open>\n              <input\n                autoFocus\n                type=\"range\"\n                min=\"0\"\n                max=\"100\"\n                value={row.progress}\n                onChange={(e) => onRowChange({ ...row, progress: e.target.valueAsNumber })}\n              />\n              <menu>\n                <button type=\"button\" onClick={() => onClose()}>\n                  Cancel\n                </button>\n                <button type=\"button\" onClick={() => onClose(true)}>\n                  Save\n                </button>\n              </menu>\n            </dialog>\n          </div>,\n          document.body\n        );\n      },\n      editorOptions: {\n        displayCellContent: true\n      }\n    },\n    {\n      key: 'startTimestamp',\n      name: 'Start date',\n      renderCell(props) {\n        return dateFormatter.format(props.row.startTimestamp);\n      }\n    },\n    {\n      key: 'endTimestamp',\n      name: 'Deadline',\n      renderCell(props) {\n        return dateFormatter.format(props.row.endTimestamp);\n      }\n    },\n    {\n      key: 'budget',\n      name: 'Budget',\n      renderCell(props) {\n        return currencyFormatter.format(props.row.budget);\n      }\n    },\n    {\n      key: 'transaction',\n      name: 'Transaction type'\n    },\n    {\n      key: 'account',\n      name: 'Account'\n    },\n    {\n      key: 'version',\n      name: 'Version',\n      renderEditCell: textEditor\n    },\n    {\n      key: 'available',\n      name: 'Available',\n      renderCell({ row, onRowChange, tabIndex }) {\n        return (\n          <SelectCellFormatter\n            value={row.available}\n            onChange={() => {\n              onRowChange({ ...row, available: !row.available });\n            }}\n            tabIndex={tabIndex}\n          />\n        );\n      },\n      renderSummaryCell({ row: { yesCount, totalCount } }) {\n        return `${Math.floor((100 * yesCount) / totalCount)}% ✔️`;\n      }\n    }\n  ];\n}\n\nfunction rowKeyGetter(row: Row) {\n  return row.id;\n}\n\nlet countries: string[] = [];\n\nfunction createRows(): readonly Row[] {\n  const now = Date.now();\n  const rows: Row[] = [];\n  const countrySet = new Set<string>();\n\n  for (let i = 0; i < 1000; i++) {\n    const country = faker.location.country();\n    countrySet.add(country);\n\n    rows.push({\n      id: i,\n      title: `Task #${i + 1}`,\n      client: faker.company.name(),\n      area: faker.person.jobArea(),\n      country,\n      contact: faker.internet.exampleEmail(),\n      assignee: faker.person.fullName(),\n      progress: Math.random() * 100,\n      startTimestamp: now - Math.round(Math.random() * 1e10),\n      endTimestamp: now + Math.round(Math.random() * 1e10),\n      budget: 500 + Math.random() * 10500,\n      transaction: faker.finance.transactionType(),\n      account: faker.finance.iban(),\n      version: faker.system.semver(),\n      available: Math.random() > 0.5\n    });\n  }\n\n  countries = [...countrySet].sort(new Intl.Collator().compare);\n\n  return rows;\n}\n\ntype Comparator = (a: Row, b: Row) => number;\n\nfunction getComparator(sortColumn: string): Comparator {\n  switch (sortColumn) {\n    case 'assignee':\n    case 'title':\n    case 'client':\n    case 'area':\n    case 'country':\n    case 'contact':\n    case 'transaction':\n    case 'account':\n    case 'version':\n      return (a, b) => {\n        return a[sortColumn].localeCompare(b[sortColumn]);\n      };\n    case 'available':\n      return (a, b) => {\n        return a[sortColumn] === b[sortColumn] ? 0 : a[sortColumn] ? 1 : -1;\n      };\n    case 'id':\n    case 'progress':\n    case 'startTimestamp':\n    case 'endTimestamp':\n    case 'budget':\n      return (a, b) => {\n        return a[sortColumn] - b[sortColumn];\n      };\n    default:\n      throw new Error(`unsupported sortColumn: \"${sortColumn}\"`);\n  }\n}\n\nfunction CommonFeatures() {\n  const direction = useDirection();\n  const [rows, setRows] = useState(createRows);\n  const [sortColumns, setSortColumns] = useState<readonly SortColumn[]>([]);\n  const [selectedRows, setSelectedRows] = useState((): ReadonlySet<number> => new Set());\n  const [isExporting, setIsExporting] = useState(false);\n  const gridRef = useRef<DataGridHandle>(null);\n  const columns = useMemo(() => getColumns(countries, direction), [direction]);\n\n  const summaryRows = useMemo((): readonly SummaryRow[] => {\n    return [\n      {\n        id: 'total_0',\n        totalCount: rows.length,\n        yesCount: rows.filter((r) => r.available).length\n      }\n    ];\n  }, [rows]);\n\n  const sortedRows = useMemo((): readonly Row[] => {\n    if (sortColumns.length === 0) return rows;\n\n    return rows.toSorted((a, b) => {\n      for (const sort of sortColumns) {\n        const comparator = getComparator(sort.columnKey);\n        const compResult = comparator(a, b);\n        if (compResult !== 0) {\n          return sort.direction === 'ASC' ? compResult : -compResult;\n        }\n      }\n      return 0;\n    });\n  }, [rows, sortColumns]);\n\n  function handleExportToCsv() {\n    flushSync(() => {\n      setIsExporting(true);\n    });\n\n    exportToCsv(gridRef.current!.element!, 'CommonFeatures.csv');\n\n    flushSync(() => {\n      setIsExporting(false);\n    });\n  }\n\n  async function handleExportToPdf() {\n    flushSync(() => {\n      setIsExporting(true);\n    });\n\n    await exportToPdf(gridRef.current!.element!, 'CommonFeatures.pdf');\n\n    flushSync(() => {\n      setIsExporting(false);\n    });\n  }\n\n  return (\n    <>\n      <div className={toolbarClassname}>\n        <button type=\"button\" onClick={handleExportToCsv}>\n          Export to CSV\n        </button>\n        <button type=\"button\" onClick={handleExportToPdf}>\n          Export to PDF\n        </button>\n      </div>\n      <DataGrid\n        ref={gridRef}\n        aria-label=\"Common Features Example\"\n        rowKeyGetter={rowKeyGetter}\n        columns={columns}\n        rows={sortedRows}\n        defaultColumnOptions={{\n          sortable: true,\n          resizable: true\n        }}\n        selectedRows={selectedRows}\n        onSelectedRowsChange={setSelectedRows}\n        onRowsChange={setRows}\n        sortColumns={sortColumns}\n        onSortColumnsChange={setSortColumns}\n        topSummaryRows={summaryRows}\n        bottomSummaryRows={summaryRows}\n        className=\"fill-grid\"\n        direction={direction}\n        enableVirtualization={!isExporting}\n      />\n    </>\n  );\n}\n"],"mappings":"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"}